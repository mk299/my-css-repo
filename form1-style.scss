/****************************************
 * Boost!Injector カスタマイズCSS
 * 対象：個人目標管理フォーム
 * 概要:
 * - 共通の色/余白/角丸などを変数化
 * - 既存CSSをSCSSネストで整理
 * 対象: .kb-injector配下のフォーム/テーブルUI
 ****************************************/

// ===== 0) 共通変数 ===== */
$primary-color: #0040a6;
$primary-color-inverse: #ffffff;
$secondary-color: #585e61;
$secondary-color-light: #dceaff;
$accent-color: #ffa500;
$background-color: #ffffff;
$secondary-background-color: #f7fafcbf;
$text-color: #2e3740;

// UIトークン */
$radius: 8px;
$gap-sm: 8px;
$gap-md: 12px;
$gap-lg: 16px;
$border-color: #ccc;
// 必要なら: mix($secondary-color, #fff, 70%) などに変更 */
$label-width: 30%;
$bp-md: 768px;

// ===== 1) ベース（共通の見た目）===== */
body .kb-injector {
  font-size: 18px;

  // 部品 */
  .kb-injector-button {
    width: 70%;
  }

  // ヘッダ */
  .kb-injector-main .kb-injector-header {
    background-color: $background-color;
    border-radius: $radius !important;
    padding: 0.5em;
  }

  // ボディ */
  .kb-injector-main .kb-injector-body {
    background-color: $background-color;
    color: $text-color;
    border-radius: $radius !important;
    padding: 0.5em;

    .kb-field-value.kb-number input[type="text"],
    .kb-field-value.kb-dropdown select,
    .kb-field-value.kb-textarea textarea,
    .kb-field-value.kb-text input[type="text"],
    .kb-field-value.kb-lookup input.kb-lookup-search {
      color: $text-color !important;
      border: 1px solid $border-color !important;
      border-radius: $radius !important;
      padding: 0.1em 0.2em !important;

      &:focus {
        outline: none !important;
        border-color: $primary-color !important;
        box-shadow: 0 0 0 3px rgba($primary-color, 0.15) !important;
      }
    }

    .kb-field .kb-field-caption {
      color: $secondary-color !important;
      font-weight: 600 !important;
    }

    .kb-field .kb-guide,
    .kb-field .kb-unit {
      color: $secondary-color !important;
    }

    // === 共通：フォームフィールドのマージン調整 === */
    .kb-field {
      margin-bottom: 1em !important;
      padding-bottom: 0;
    }

    // === 1. 「目標設定年度」「目標設定期間」を横並び === */
    .kb-field[field-id="目標設定年度"],
    .kb-field[field-id="目標設定期間"] {
      display: inline-block !important;
      width: 48% !important;
      margin-right: 2% !important;
      vertical-align: top !important;
    }

    // 「年度」などの補助テキストを非表示（年度側のみ） */
    .kb-field[field-id="目標設定年度"] {
      .kb-guide,
      .kb-unit {
        display: none !important;
      }
    }

    // === 2. Boost! テーブル行を 2列に表示（レスポンシブ対応）=== */
    .kb-table.kb-scope > div.kb-table-row {
      display: flex !important;
      flex-wrap: wrap !important;
      gap: $gap-md !important;
      margin-bottom: $gap-md !important;
      border-bottom: 1px dashed $border-color !important;
      padding-bottom: $gap-md !important;

      // テーブル内各フィールド（2列構成） */
      > div {
        flex: 1 1 calc(50% - #{$gap-md}) !important;
        box-sizing: border-box !important;
      }
    }

    // 画面が狭くなったら1列に切り替え */
    @media (max-width: $bp-md) {
      .kb-table.kb-scope > div.kb-table-row > div {
        flex: 1 1 100% !important;
      }
    }

    // === 3. テーブル内フィールド（ラベルと入力欄）を横並び === */
    .kb-table {
      .kb-field {
        display: flex !important;
        align-items: center !important;
        gap: $gap-sm !important;
      }

      // ラベル（固定幅で左に） */
      .kb-field .kb-field-caption {
        white-space: nowrap !important;
        width: $label-width !important;
        flex-shrink: 0 !important;
        overflow: visible !important;
      }

      // 入力欄（右側に広げる） */
      .kb-field .kb-field-value {
        flex: 1 !important;
      }
    }

    // ===== 4) 実際のHTMLテーブル構造に対応 ===== */
    table.kb-table {
      width: 100% !important;
      border-collapse: separate !important;
      border-spacing: 0 !important;
      // background: $secondary-background-color !important;
      border-radius: $radius !important;
      overflow: hidden !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
      margin-bottom: $gap-lg !important;

      tbody tr.kb-scope {
        &:nth-child(even) {
          background-color: rgba($secondary-color-light, 0.3) !important;
        }
      }

      td {
        padding: $gap-md !important;
        border-bottom: 1px solid rgba($border-color, 0.5) !important;
        vertical-align: top !important;

        &:last-child.kb-table-button.kb-table-button-extension {
          width: 120px !important; // ボタン列の幅固定
        }

        .kb-field {
          margin-bottom: 0 !important;

          .kb-field-caption {
            font-size: 0.9em !important;
            margin-bottom: 4px !important;
            display: block !important;
          }

          .kb-field-value {
            width: 100% !important;

            &.kb-number input[type="text"],
            &.kb-dropdown select,
            &.kb-textarea textarea {
              width: 100% !important;
              box-sizing: border-box !important;
            }

            &.kb-textarea textarea {
              min-height: 60px !important;
              resize: vertical !important;
            }
          }
        }
      }
    }

    // ===== 5) テーブルキャプション ===== */
    span.kb-table-caption {
      font-size: 1.1em !important;
      font-weight: 600 !important;
      color: $primary-color !important;
      margin-bottom: $gap-sm !important;
      padding: $gap-sm 0 !important;
      border-bottom: 2px solid $primary-color !important;
      display: block !important;

      &::before {
        content: "📊 " !important;
        margin-right: 4px !important;
      }
    }

    // ===== 6) ボタンスタイル改善 ===== */
    td.kb-table-button.kb-table-button-extension {
      text-align: center !important;
      display: flex;
      align-items: center;
      gap: 0.375rem;

      button.kb-icon {
        border: 1px solid $border-color !important;
        border-radius: $radius !important;
        padding: 6px 22px !important;
        margin: 2px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;

        &:hover {
          background: $secondary-color-light !important;
          border-color: $primary-color !important;
        }

        &.kb-table-row-add.kb-icon-add {
          color: #28a745 !important;

          &:hover {
            background: rgba(40, 167, 69, 0.1) !important;
          }
        }

        &.kb-table-row-copy.kb-icon-copy {
          color: $primary-color !important;

          &:hover {
            background: rgba($primary-color, 0.1) !important;
          }
        }

        &.kb-table-row-del.kb-icon-del {
          color: #dc3545 !important;

          &:hover {
            background: rgba(220, 53, 69, 0.1) !important;
          }
        }
      }
    }

    // ===== 7) ヘッダー部分の改善 ===== */
    .kb-injector-header {
      background: linear-gradient(135deg, $primary-color, lighten($primary-color, 10%)) !important;
      color: $primary-color-inverse !important;
      padding: $gap-lg !important;
      border-radius: $radius $radius 0 0 !important;
      margin-bottom: $gap-lg !important;

      .kb-injector-header-title {
        font-size: 1.5em !important;
        font-weight: 700 !important;
        margin-bottom: $gap-sm !important;

        &::before {
          content: "🎯 " !important;
          margin-right: $gap-sm !important;
        }
      }

      .kb-injector-header-description {
        opacity: 0.9 !important;
        font-size: 0.95em !important;
      }
    }

    // ===== 8) フッターボタン ===== */
    .kb-injector-footer {
      margin-top: $gap-lg !important;
      text-align: center !important;

      .kb-injector-button {
        background: $accent-color !important;
        color: $primary-color-inverse !important;
        border: none !important;
        padding: $gap-md #{$gap-lg * 2} !important;
        border-radius: $radius !important;
        font-size: 1.1em !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 4px 12px rgba($accent-color, 0.3) !important;

        &:hover {
          background: darken($accent-color, 10%) !important;
          transform: translateY(-2px) !important;
          box-shadow: 0 6px 16px rgba($accent-color, 0.4) !important;
        }

        &:active {
          transform: translateY(0) !important;
          box-shadow: 0 2px 8px rgba($accent-color, 0.3) !important;
        }
      }
    }

    // ===== 9) レスポンシブ対応（モバイル）===== */
    @media (max-width: $bp-md) {
      .kb-field[field-id="目標設定年度"],
      .kb-field[field-id="目標設定期間"] {
        display: block !important;
        width: 100% !important;
        margin-right: 0 !important;
        margin-bottom: $gap-md !important;
      }

      table.kb-table {
        .kb-field {
          display: block !important;
        }

        font-size: 0.9em !important;

        td {
          padding: $gap-sm !important;
          display: block !important;
          width: 100% !important;
          border-bottom: 1px solid $border-color !important;

          &:last-child.kb-table-button.kb-table-button-extension {
            width: 100% !important;
            text-align: center !important;
            padding-top: $gap-md !important;
            border-bottom: 2px solid $primary-color !important;
          }
        }

        .kb-field .kb-field-caption,
        .kb-field .kb-field-value {
          width: 100%;
        }

        tbody tr.kb-scope {
          display: block !important;
          border: 1px solid $border-color !important;
          border-radius: $radius !important;
          margin-bottom: $gap-md !important;
          background: $background-color !important;

          &:hover {
            box-shadow: 0 4px 12px rgba($primary-color, 0.15) !important;
          }
        }
      }
    }

    // ===== 10) 非表示フィールドのスタイル（開発用）===== */
    .kb-field.kb-unuse {
      display: none !important;
    }

    // ===== 11) 入力欄エラー表示の改善 ===== */
    .kb-field-value {
      position: relative !important;

      // エラートースト的な表示 */
      > div[style*="display: none"] {
        position: absolute !important;
        top: 100% !important;
        left: 0 !important;
        z-index: 1000 !important;
        margin-top: 4px !important;

        span {
          background: #dc3545 !important;
          color: white !important;
          padding: $gap-sm !important;
          border-radius: $radius !important;
          font-size: 0.85em !important;
          white-space: nowrap !important;
          box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3) !important;

          &::before {
            content: "⚠️ " !important;
          }
        }
      }
    }

    // ===== 12) アニメーション効果 ===== */
    .kb-field,
    .kb-table,
    .kb-injector-button {
      transition: all 0.2s ease !important;
    }

    // フォーカス時のフィールドハイライト */
    .kb-field:focus-within {
      .kb-field-caption {
        color: $primary-color !important;
        font-weight: 700 !important;
      }
    }
  }
}
